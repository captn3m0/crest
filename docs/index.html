<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta id="repository-name" content="github.com/mamantoha/crest">
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="js/doc.js"></script>
  <title>README - github.com/mamantoha/crest</title>
</head>
<body>

<div id="types-list">
  <div id="search-box">
    <input type="search" id="search-input" placeholder="Search...">
  </div>

  <ul>
    <li class="current"><a href="index.html">README</a></li>
  </ul>

  <ul>
  
  <li class="parent " data-id="github.com/mamantoha/crest/Crest" data-name="crest">
      <a href="Crest.html">Crest</a>
      
        <ul>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/CommonLogger" data-name="crest::commonlogger">
      <a href="Crest/CommonLogger.html">CommonLogger</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Exception" data-name="crest::exception">
      <a href="Crest/Exception.html">Exception</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Logger" data-name="crest::logger">
      <a href="Crest/Logger.html">Logger</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Payload" data-name="crest::payload">
      <a href="Crest/Payload.html">Payload</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Request" data-name="crest::request">
      <a href="Crest/Request.html">Request</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/RequestFailed" data-name="crest::requestfailed">
      <a href="Crest/RequestFailed.html">RequestFailed</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Resource" data-name="crest::resource">
      <a href="Crest/Resource.html">Resource</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Response" data-name="crest::response">
      <a href="Crest/Response.html">Response</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/TextValue" data-name="crest::textvalue">
      <a href="Crest/TextValue.html">TextValue</a>
      
    </li>
  
  <li class=" " data-id="github.com/mamantoha/crest/Crest/Utils" data-name="crest::utils">
      <a href="Crest/Utils.html">Utils</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/mamantoha/crest/HTTP" data-name="http">
      <a href="HTTP.html">HTTP</a>
      
        <ul>
  
  <li class=" " data-id="github.com/mamantoha/crest/HTTP/Client" data-name="http::client">
      <a href="HTTP/Client.html">Client</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

</div>

<div id="main-content">
<p><img src="https://raw.github.com/mamantoha/crest/master/crest.png" alt="Crest Logo"/></p>

<p><a href="https://travis-ci.org/mamantoha/crest" target="_blank"><img src="http://img.shields.io/travis/mamantoha/crest.svg?style=flat" alt="Build Status"/></a>
<a href="https://github.com/mamantoha/crest/releases" target="_blank"><img src="https://img.shields.io/github/release/mamantoha/crest.svg" alt="GitHub release"/></a>
<a href="https://shards.rocks/github/mamantoha/crest" target="_blank"><img src="https://shards.rocks/badge/github/mamantoha/crest/status.svg" alt="Dependency Status"/></a>
<a href="https://shards.rocks/github/mamantoha/crest" target="_blank"><img src="https://shards.rocks/badge/github/mamantoha/crest/dev_status.svg" alt="devDependency Status"/></a>
<a href="https://github.com/mamantoha/crest/blob/master/LICENSE" target="_blank"><img src="https://img.shields.io/github/license/mamantoha/crest.svg" alt="License"/></a></p>

<p>Simple HTTP and REST client for Crystal, inspired by the Ruby's RestClient gem.</p>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class='language-yaml'>dependencies:
  crest:
    github: mamantoha/crest</code></pre>

<h2>Usage</h2>

<pre><code class='language-crystal'><span class="k">require</span> <span class="s">&quot;crest&quot;</span></code></pre>

<p>Basic usage:</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.get(<span class="s">&quot;http://example.com/resource&quot;</span>, params: {<span class="n">:lang</span> => <span class="s">&quot;ua&quot;</span>})
<span class="t">Crest</span>.post(<span class="s">&quot;http://example.com/resource&quot;</span>, payload: {<span class="n">:params1</span> => <span class="s">&quot;one&quot;</span>, <span class="n">:nested</span> => {<span class="n">:params2</span> => <span class="s">&quot;two&quot;</span>}})</code></pre>

<h3>Passing advanced options</h3>

<p><code><a href="Crest/Request.html">Crest::Request</a></code> accept next parameters:</p>

<p>Mandatory parameters:</p>

<ul><li><code>:method</code> - HTTP method (<code>:get</code>. <code>:post</code>, <code>:put</code>, <code>:patch</code>,  <code>:delete</code>)</li><li><code>:url</code> - URL (e.g.: "http://httpbin.org/ip")</li></ul>

<p>Optional parameters:</p>

<ul><li><code>:payload</code> -  a hash containing query params</li><li><code>:headers</code> -  a hash containing the request headers</li><li><code>:cookies</code> -  a hash containing the request cookies</li><li><code>:params</code> -  a hash that represent query-string separated from the preceding part by a question mark (<code>?</code>) a sequence of attributeâ€“value pairs separated by a delimiter (<code>&</code>)</li><li><code>:user</code> and <code>:password</code> -  for Basic Authentication</li><li><code>:p_addr</code>, <code>:p_port</code>, <code>:p_user</code>, and <code>:p_pass</code> - specify a per-request proxy by passing these parameters</li><li><code>:max_redirects</code> -  maximum number of redirections (default to 10)</li><li><code>:logging</code> -  enable logging (default to <code>false</code>)</li><li><code>:logger</code> -  set logger (default to <code><a href="Crest/CommonLogger.html">Crest::CommonLogger</a></code>)</li></ul>

<p>More detailed examples:</p>

<pre><code class='language-crystal'><span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>(<span class="n">:get</span>, <span class="s">&quot;http://example.com/resource&quot;</span>, headers: {<span class="s">&quot;Content-Type&quot;</span> => <span class="s">&quot;application/json&quot;</span>})
<span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>(<span class="n">:delete</span>, <span class="s">&quot;http://example.com/resource/1&quot;</span>, params: {<span class="n">:lang</span> => <span class="s">&quot;ua&quot;</span>})
<span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>(<span class="n">:post</span>, <span class="s">&quot;http://example.com/resource&quot;</span>, headers: {<span class="s">&quot;Content-Type&quot;</span> => <span class="s">&quot;application/json&quot;</span>}, payload: {<span class="n">:foo</span> => <span class="s">&quot;bar&quot;</span>})
<span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>(<span class="n">:patch</span>, <span class="s">&quot;http://example.com/resource/1&quot;</span>, headers: {<span class="s">&quot;Content-Type&quot;</span> => <span class="s">&quot;application/json&quot;</span>}, payload: {<span class="n">:foo</span> => <span class="s">&quot;bar&quot;</span>})
<span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.<span class="k">new</span>(<span class="n">:get</span>, <span class="s">&quot;http://example.com/resource&quot;</span>, user: <span class="s">&quot;admin&quot;</span>, password: <span class="s">&quot;1234&quot;</span>)</code></pre>

<h3>Multipart</h3>

<p>Yeah, that's right! This does multipart sends for you!</p>

<pre><code class='language-crystal'>file <span class="o">=</span> <span class="t">File</span>.open(<span class="s">&quot;</span><span class="i">#{</span></span>__DIR__<span class="s"><span class="i">}</span>/example.png&quot;</span>)
<span class="t">Crest</span>.post(<span class="s">&quot;http://example.com/upload&quot;</span>, payload: {<span class="n">:image</span> => file})</code></pre>

<h3>JSON payload</h3>

<p><code>crest</code> does not speak JSON natively, so serialize your payload to a string before passing it to <code>crest</code>.</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.post(<span class="s">&quot;http://example.com/&quot;</span>, headers: {<span class="s">&quot;Content-Type&quot;</span> => <span class="s">&quot;application/json&quot;</span>}, payload: {<span class="n">:foo</span> => <span class="s">&quot;bar&quot;</span>}.to_json)</code></pre>

<h3>Headers</h3>

<p>Request headers can be set by passing a hash containing keys and values representing header names and values:</p>

<pre><code class='language-crystal'>response <span class="o">=</span> <span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/headers&quot;</span>, headers: {<span class="s">&quot;Authorization&quot;</span> => <span class="s">&quot;Bearer cT0febFoD5lxAlNAXHo6g&quot;</span>})
response.headers
<span class="c"># =&gt; {&quot;Authorization&quot; =&gt; [&quot;Bearer cT0febFoD5lxAlNAXHo6g&quot;]}</span></code></pre>

<h3>Cookies</h3>

<p><code>Request</code> and <code>Response</code> objects know about HTTP cookies, and will automatically extract and set headers for them as needed:</p>

<pre><code class='language-crystal'>response <span class="o">=</span> <span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/cookies/set&quot;</span>, params: {<span class="s">&quot;k1&quot;</span> => <span class="s">&quot;v1&quot;</span>, <span class="s">&quot;k2&quot;</span> => <span class="s">&quot;v2&quot;</span>})
response.cookies
<span class="c"># =&gt; {&quot;k1&quot; =&gt; &quot;v1&quot;, &quot;k2&quot; =&gt; &quot;v2&quot;}</span>

response <span class="o">=</span> <span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/cookies&quot;</span>, cookies: {<span class="s">&quot;k1&quot;</span> => <span class="s">&quot;v1&quot;</span>})
response.cookies
<span class="c"># =&gt; {&quot;k1&quot; =&gt; &quot;v1&quot;}</span></code></pre>

<h3>Basic authentication</h3>

<p>For basic access authentication for an HTTP user agent you should to provide a user name and password when making a request.</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/basic-auth/user/passwd&quot;</span>, user: <span class="s">&quot;user&quot;</span>, password: <span class="s">&quot;passwd&quot;</span>)</code></pre>

<h3>Proxy</h3>

<p>If you need to use a proxy, you can configure individual requests with the proxy host and port arguments to any request method:</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/ip&quot;</span>, p_addr: <span class="s">&quot;localhost&quot;</span>, p_port: <span class="n">3128</span>)</code></pre>

<p>To use HTTP Basic Auth with your proxy, use next syntax:</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.get(<span class="s">&quot;http://httpbin.org/ip&quot;</span>, p_addr: <span class="s">&quot;localhost&quot;</span>, p_port: <span class="n">3128</span>, p_user: <span class="s">&quot;user&quot;</span>, p_pass: <span class="s">&quot;qwerty&quot;</span>)</code></pre>

<h3>Logging</h3>

<p>By default, the <code><a href="Crest.html">Crest</a></code> does not enable logging. You can enable it per request by setting <code>logging: true</code>:</p>

<pre><code class='language-crystal'><span class="t">Crest</span>.get(<span class="s">&quot;http://example.com/resource&quot;</span>, logging: <span class="n">true</span>)</code></pre>

<p>You can create the custom logger by integration <code><a href="Crest/Logger.html">Crest::Logger</a></code> abstract class.
Here has two methods must be implement: <code>Crest::Logger.request</code> and <code>Crest::Logger.response</code>.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">MyLogger</span> <span class="o"><</span> <span class="t">Crest</span><span class="t">::</span><span class="t">Logger</span>
  <span class="k">def</span> <span class="m">request</span>(request)
    @logger.info <span class="s">&quot;&gt;&gt; | %s | %s&quot;</span> <span class="o">%</span> [request.method, request.url]
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">response</span>(response)
    @logger.info <span class="s">&quot;&lt;&lt; | %s | %s&quot;</span> <span class="o">%</span> [response.status_code, response.url]
  <span class="k">end</span>
<span class="k">end</span>

<span class="t">Crest</span>.get(<span class="s">&quot;http://example.com/resource&quot;</span>, logging: <span class="n">true</span>, logger: <span class="t">MyLogger</span>.<span class="k">new</span>)</code></pre>

<h3>Resource</h3>

<pre><code class='language-crystal'>resource <span class="o">=</span> <span class="t">Crest</span><span class="t">::</span><span class="t">Resource</span>.<span class="k">new</span>(<span class="s">&quot;http://localhost&quot;</span>, headers: {<span class="s">&quot;Content-Type&quot;</span> => <span class="s">&quot;application/json&quot;</span>})
resource.get({<span class="s">&quot;X-Something&quot;</span> => <span class="s">&quot;1&quot;</span>})</code></pre>

<h3>Resource Nesting</h3>

<pre><code class='language-crystal'>site <span class="o">=</span> <span class="t">Crest</span><span class="t">::</span><span class="t">Resource</span>.<span class="k">new</span>(</code></pre>

<h3>Exceptions</h3>

<ul><li>for result codes between <code>200</code> and <code>207</code>, a <code><a href="Crest/Response.html">Crest::Response</a></code> will be returned</li><li>for result codes <code>301</code>, <code>302</code>, <code>303</code> or <code>307</code>, the redirection will be followed and the request transformed into a <code>GET</code></li><li>for other cases, a <code><a href="Crest/RequestFailed.html">Crest::RequestFailed</a></code> holding the Response will be raised</li><li>call <code>.response</code> on the exception to get the server's response</li></ul>

<h3>Redirection</h3>

<p>By default, <code>crest</code> will follow HTTP 30x redirection requests.</p>

<p>To disable automatic redirection, set <code>:max_redirects => 0</code>.</p>

<pre><code class='language-crystal'><span class="t">Crest</span><span class="t">::</span><span class="t">Request</span>.execute(method: <span class="n">:get</span>, url: <span class="s">&quot;http://httpbin.org/redirect/1&quot;</span>, max_redirects: <span class="n">0</span>)
<span class="c"># Crest::RequestFailed: 302 Found</span></code></pre>

<h2>Result handling</h2>

<p>The result of a <code><a href="Crest/Request.html">Crest::Request</a></code> is a <code><a href="Crest/Response.html">Crest::Response</a></code> object.</p>

<p>Response objects have several useful methods.</p>

<ul><li><code>Response#body</code>: The response body as a string</li><li><code>Response#status_code</code>: The HTTP response code</li><li><code>Response#headers</code>: A hash of HTTP response headers</li><li><code>Response#cookies</code>: A hash of HTTP cookies set by the server</li><li><code>Response#request</code>: The <code><a href="Crest/Request.html">Crest::Request</a></code> object used to make the request</li><li><code>Response#http_client_res</code>: The <code><a href="HTTP/Client.html">HTTP::Client</a>::Response</code> object</li><li><code>Response#history</code>: A list of each response received in a redirection chain</li></ul>

<h2>Development</h2>

<p>Install dependencies:</p>

<pre><code>shards</code></pre>

<p>To run test:</p>

<pre><code>make test</code></pre>

<h3>Workbook</h3>

<pre><code>crystal play
open http<span class="n">:/</span><span class="s">/localhost:8080</code></pre>

<p>Then select the Workbook -> Requests from the menu.</p>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/mamantoha/crest/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'Add some feature')</li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/mamantoha" target="_blank">mamantoha</a> Anton Maminov - creator, maintainer</li></ul>

<h2>License</h2>

<p>Copyright: 2017-2018 Anton Maminov (anton.maminov@gmail.com)</p>

<p>This library is distributed under the MIT license. Please see the LICENSE file.</p>
</div>
</body>
</html>
